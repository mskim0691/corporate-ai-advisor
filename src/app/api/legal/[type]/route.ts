import { NextResponse } from "next/server"
import prisma from "@/lib/prisma"

// 기본 약관 내용 (마크다운)
const DEFAULT_TERMS = `# 서비스 이용약관

## 제1조 (목적)

이 약관은 이엑스이사일일(이하 "회사")가 제공하는 AI-GFC 서비스(이하 "서비스")의 이용조건 및 절차, 회사와 이용자의 권리, 의무, 책임사항과 기타 필요한 사항을 규정함을 목적으로 합니다.

## 제2조 (정의)

1. "서비스"란 회사가 제공하는 AI 기반 법인 컨설팅 분석 서비스를 말합니다.
2. "이용자"란 이 약관에 따라 회사가 제공하는 서비스를 이용하는 회원을 말합니다.
3. "회원"이란 회사에 개인정보를 제공하여 회원등록을 한 자로서, 회사의 정보를 지속적으로 제공받으며 서비스를 계속적으로 이용할 수 있는 자를 말합니다.

## 제3조 (약관의 효력 및 변경)

1. 이 약관은 서비스 화면에 게시하거나 기타의 방법으로 회원에게 공지함으로써 효력이 발생합니다.
2. 회사는 합리적인 사유가 발생할 경우 관련 법령에 위배되지 않는 범위 내에서 이 약관을 변경할 수 있으며, 변경된 약관은 제1항과 같은 방법으로 공지합니다.

## 제4조 (서비스의 제공)

1. 회사는 다음과 같은 서비스를 제공합니다.
   - AI 기반 기업 재무 분석 서비스
   - 컨설팅 리포트 생성 서비스
   - 비주얼 레포트 생성 서비스
   - 기타 회사가 정하는 서비스
2. 서비스는 연중무휴, 1일 24시간 제공함을 원칙으로 합니다. 단, 시스템 점검 등의 필요에 의해 서비스가 일시 중단될 수 있습니다.

## 제5조 (회원가입)

1. 이용자는 회사가 정한 가입 양식에 따라 회원정보를 기입한 후 이 약관에 동의한다는 의사표시를 함으로써 회원가입을 신청합니다.
2. 회사는 제1항과 같이 회원으로 가입할 것을 신청한 이용자 중 다음 각 호에 해당하지 않는 한 회원으로 등록합니다.

## 제6조 (회원 탈퇴 및 자격 상실)

1. 회원은 회사에 언제든지 탈퇴를 요청할 수 있으며 회사는 즉시 회원탈퇴를 처리합니다.
2. 회원이 다음 각 호의 사유에 해당하는 경우, 회사는 회원자격을 제한 및 정지시킬 수 있습니다.

## 제7조 (이용자의 의무)

이용자는 다음 행위를 하여서는 안 됩니다.

- 신청 또는 변경 시 허위내용의 등록
- 타인의 정보 도용
- 회사가 게시한 정보의 변경
- 회사가 정한 정보 이외의 정보(컴퓨터 프로그램 등) 등의 송신 또는 게시
- 회사와 기타 제3자의 저작권 등 지적재산권에 대한 침해
- 회사 및 기타 제3자의 명예를 손상시키거나 업무를 방해하는 행위

## 제8조 (저작권의 귀속)

1. 서비스에 의해 생성된 분석 결과물의 저작권은 회사에 귀속됩니다.
2. 이용자는 서비스를 통해 생성된 결과물을 개인적 또는 업무적 용도로 사용할 수 있습니다.

## 제9조 (면책조항)

1. 회사는 천재지변 또는 이에 준하는 불가항력으로 인하여 서비스를 제공할 수 없는 경우에는 서비스 제공에 관한 책임이 면제됩니다.
2. 회사는 이용자의 귀책사유로 인한 서비스 이용의 장애에 대하여는 책임을 지지 않습니다.
3. AI 분석 결과는 참고용으로 제공되며, 최종 의사결정은 이용자의 책임하에 이루어져야 합니다.

## 제10조 (분쟁해결)

1. 회사는 이용자가 제기하는 정당한 의견이나 불만을 반영하고 그 피해를 보상처리하기 위하여 고객센터를 운영합니다.
2. 회사와 이용자 간에 발생한 전자상거래 분쟁에 관한 소송은 서울중앙지방법원을 관할 법원으로 합니다.

---

**부칙**

이 약관은 2025년 1월 1일부터 시행합니다.`

const DEFAULT_PRIVACY = `# 개인정보처리방침

이엑스이사일일(이하 "회사")는 개인정보보호법에 따라 이용자의 개인정보 보호 및 권익을 보호하고 개인정보와 관련한 이용자의 고충을 원활하게 처리할 수 있도록 다음과 같은 처리방침을 두고 있습니다.

## 제1조 (개인정보의 수집 및 이용목적)

회사는 다음의 목적을 위하여 개인정보를 처리합니다. 처리하고 있는 개인정보는 다음의 목적 이외의 용도로는 이용되지 않으며, 이용 목적이 변경되는 경우에는 별도의 동의를 받는 등 필요한 조치를 이행할 예정입니다.

- **회원 가입 및 관리:** 회원제 서비스 이용에 따른 본인확인, 개인식별, 불량회원의 부정이용 방지, 각종 고지·통지 등
- **서비스 제공:** AI 분석 서비스 제공, 맞춤형 서비스 제공, 본인인증 등
- **결제 처리:** 유료 서비스 이용 시 결제 처리

## 제2조 (수집하는 개인정보 항목)

회사는 회원가입, 서비스 이용 등을 위해 아래와 같은 개인정보를 수집하고 있습니다.

- **필수항목:** 이메일 주소, 비밀번호, 이름
- **자동수집항목:** IP주소, 쿠키, 서비스 이용기록, 접속 로그
- **결제 시:** 결제정보(결제수단, 결제금액 등)

## 제3조 (개인정보의 보유 및 이용기간)

회사는 법령에 따른 개인정보 보유·이용기간 또는 정보주체로부터 개인정보를 수집 시에 동의받은 개인정보 보유·이용기간 내에서 개인정보를 처리·보유합니다.

- **회원 정보:** 회원 탈퇴 시까지 (단, 관계 법령에 따라 보존할 필요가 있는 경우 해당 기간)
- **전자상거래 관련 기록:** 5년 (전자상거래 등에서의 소비자보호에 관한 법률)
- **접속 로그:** 3개월 (통신비밀보호법)

## 제4조 (개인정보의 제3자 제공)

회사는 원칙적으로 이용자의 개인정보를 제3자에게 제공하지 않습니다. 다만, 아래의 경우에는 예외로 합니다.

- 이용자가 사전에 동의한 경우
- 법령의 규정에 의거하거나, 수사 목적으로 법령에 정해진 절차와 방법에 따라 수사기관의 요구가 있는 경우

## 제5조 (개인정보처리의 위탁)

회사는 원활한 개인정보 업무처리를 위하여 다음과 같이 개인정보 처리업무를 위탁하고 있습니다.

| 위탁업체 | 위탁업무 |
|---------|---------|
| 토스페이먼츠 | 결제처리 |
| Vercel | 클라우드 호스팅 |
| Supabase | 데이터베이스 서비스 |

## 제6조 (정보주체의 권리·의무 및 행사방법)

이용자는 개인정보주체로서 다음과 같은 권리를 행사할 수 있습니다.

- 개인정보 열람 요구
- 오류 등이 있을 경우 정정 요구
- 삭제 요구
- 처리정지 요구

## 제7조 (개인정보의 안전성 확보조치)

회사는 개인정보의 안전성 확보를 위해 다음과 같은 조치를 취하고 있습니다.

- 개인정보의 암호화
- 해킹 등에 대비한 기술적 대책
- 개인정보에 대한 접근 제한

## 제8조 (개인정보 보호책임자)

회사는 개인정보 처리에 관한 업무를 총괄해서 책임지고, 개인정보 처리와 관련한 정보주체의 불만처리 및 피해구제 등을 위하여 아래와 같이 개인정보 보호책임자를 지정하고 있습니다.

- **개인정보 보호책임자:** 김민수
- **연락처:** 070-8064-8232
- **이메일:** privacy@ai-gfc.com

## 제9조 (개인정보처리방침의 변경)

이 개인정보처리방침은 시행일로부터 적용되며, 법령 및 방침에 따른 변경내용의 추가, 삭제 및 정정이 있는 경우에는 변경사항의 시행 7일 전부터 공지사항을 통하여 고지할 것입니다.

---

**시행일:** 2025년 1월 1일`

export async function GET(
  req: Request,
  { params }: { params: Promise<{ type: string }> }
) {
  try {
    const { type } = await params

    if (type !== 'terms' && type !== 'privacy') {
      return NextResponse.json({ error: "유효하지 않은 문서 유형입니다" }, { status: 400 })
    }

    let document = await prisma.legalDocument.findUnique({
      where: { type },
    })

    // 문서가 없으면 기본 내용 반환
    if (!document) {
      return NextResponse.json({
        type,
        title: type === 'terms' ? '서비스 이용약관' : '개인정보처리방침',
        content: type === 'terms' ? DEFAULT_TERMS : DEFAULT_PRIVACY,
        version: '1.0',
        updatedAt: new Date().toISOString(),
      })
    }

    return NextResponse.json(document)
  } catch (error) {
    console.error("Get legal document error:", error)
    return NextResponse.json(
      { error: "서버 오류가 발생했습니다" },
      { status: 500 }
    )
  }
}
